# загрузить только файл с рёбрами (без использования apoc)

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump' AS edge
MERGE (vs:Node {id: toInteger(edge.Src ) })
MERGE (vd:Node {id: toInteger(edge.Dest) })
MERGE (vs)-[e: EDGE {label: edge.Nterm}]->(vd);

# загрузить файлы с рёбрами и с вершинами
# (вершины, соответствующие входам и выходам
# в функцию, будут иметь соответствующие флаги)

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump.nodes' AS nod
WITH nod
MERGE (n:Node {id: toInteger(nod.NodeID), flags: split(nod.NodeFlags, '|'), function: toInteger(nod.FunctionID)});

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump' AS edge
WITH edge
MATCH (src {id: toInteger(edge.Src)}), (dest {id: toInteger(edge.Dest)})
MERGE (src)-[e:Edge {nterm: edge.Nterm}]->(dest);

# загрузить файлы с рёбрами и с вершинами
# этот запрос использует функции библиотеки apoc,
# которые позволят отмечать рёбра с разным нетерминалом
# разными цветами для удобства

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump.nodes' AS nod
WITH nod
MERGE (n:Node {id: toInteger(nod.NodeID), flags: split(nod.NodeFlags, '|'), function: toInteger(nod.FunctionID)});

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump' AS edge
WITH edge
MATCH (src {id: toInteger(edge.Src)}), (dest {id: toInteger(edge.Dest)})
CALL apoc.create.relationship(src, edge.Nterm, {}, dest)
YIELD rel
RETURN rel;

# загрузить call-граф

LOAD CSV WITH HEADERS FROM 'file:///<имя-теста>.vfg.dump.callgraph' AS cgedge
MERGE (fs:Function {id: cgedge.Src })
MERGE (fd:Function {id: cgedge.Dest })
MERGE (fs)-[e: CALL]->(fd);

